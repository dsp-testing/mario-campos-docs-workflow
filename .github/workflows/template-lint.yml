name: Lint Workflow Templates

on:
  pull_request:
    paths:
    - ts/workflows/versions/v*.codeql.template
    branches:
    - main

permissions:
  contents: read

jobs:
  lint:
    runs-on: ubuntu-slim
    steps:
    - name: Checkout repository
      uses: actions/checkout@v5
    - name: Checkout repository
      uses: actions/checkout@v5

    - name: Get all changed template files
      id: changed-files
      uses: tj-actions/changed-files@v47
      with:
        files: ts/workflows/versions/v*.codeql.template

    - name: Lint workflow template versions
      run: |
        for f in ${{ steps.changed-files.outputs.all_changed_files }}
        do
          version=$(basename "$f" .codeql.template)
          
          if [[ ! "$version" =~ ^v[0-9]+$ ]]; then
            echo "$f: INVALID! Template version format is invalid; expected format is vNN (e.g., v48)"
            exit 1
          fi
          
          echo "$f: âœ“ $version is a valid version number"
        done
